#jinja2:trim_blocks:True,lstrip_blocks:True
# Nginx Configuration Template
# Generated from template on {{ ansible_date_time.iso8601 }}

user {{ nginx_user }};
worker_processes {{ worker_processes }};
{% if worker_rlimit_nofile is defined %}
worker_rlimit_nofile {{ worker_rlimit_nofile }};
{% endif %}

error_log {{ error_log_path }} {{ error_log_level }};
pid {{ pid_path }};

events {
    worker_connections {{ worker_connections }};
    {% if use_epoll %}
    use epoll;
    {% endif %}
    {% if multi_accept %}
    multi_accept on;
    {% endif %}
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # Log Format
    log_format main '{{ access_log_format }}';

    access_log {{ access_log_path }} main;

    # Basic Settings
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout {{ keepalive_timeout }};
    types_hash_max_size 2048;
    server_tokens off;

    # Gzip Settings
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types {{ gzip_types | join(' ') }};
    gzip_comp_level {{ gzip_comp_level }};


    {% for server in nginx_servers %}
    server {
        listen {{ server.listen }};
        server_name {{ server.server_name }};
    }
    {% endfor %}

}